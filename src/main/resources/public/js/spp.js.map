{"version":3,"file":"spp.js","names":["baseUrl","registerUrl","loginUrl","employeeSl","unitProcSl","loginsuccess","processForm","action","form","entity","classList","contains","checkValidity","url","id","value","data","fData","FormData","set","selectize","getValue","JSON","stringify","Object","fromEntries","requestHeader","localStorage","getItem","options","method","headers","body","fetch","then","res","ok","alert","status","location","href","text","json","setItem","message","editModal","hide","$","DataTable","ajax","reload","Promise","resolve","loadField","filter","i","category","fieldId","array","maxItems","valueField","labelField","searchField","create","logout","getnewcode","document","querySelector","padStart","scCodeBlur","e","console","log","info","region","informMethod","rootCause","customerContact","nocAndTechWorks","technicalStart","doneDate","technicalDone","serviceType","dailyStatistic","qry","rows","entries","dic","forEach","o","push","index","indexOf","notBackOffice","el","notAtNoc","includes","sort","innerHTML"],"sources":["../../src/js/spp.js"],"sourcesContent":["var baseUrl = \"/api/v1/\";\nvar registerUrl = \"/auth/addNewUser\";\nvar loginUrl = \"/auth/generateToken\";\nvar employeeSl;\nvar unitProcSl;\nvar loginsuccess = false;\nfunction processForm(action, form, entity) {\n    loginsuccess = false;\n    if (action == 'GET' || (form.classList.contains('was-validated') && form.checkValidity())) {\n        let url = baseUrl + entity;\n        if (entity == 'register') url = registerUrl;\n        if (entity == 'login') url = loginUrl;\n        if (action == 'PUT') {\n            url += '/' + form.id.value;\n        }\n        let data = '';\n\n        if (form != null) {\n            let fData = new FormData(form);\n            if (entity == 'jobs')\n                fData.set('employeeCode', employeeSl[0].selectize.getValue())\n            if (entity == 'problems')\n                fData.set('unitProcess', unitProcSl[0].selectize.getValue())\n            data = JSON.stringify(Object.fromEntries(fData));\n        }\n\n        let requestHeader = {\n            \"Content-Type\": \"application/json\",\n        };\n        if (entity != 'login' && entity != 'register') {\n            requestHeader = {\n                'crossorigin': true,\n                'Access-Control-Allow-Origin': '*',\n                \"Content-Type\": \"application/json\",\n                \"Authorization\": \"Bearer \" + localStorage.getItem(\"accesstoken\")\n            };\n        }\n        let options = {\n            method: action,\n            headers: requestHeader,\n            body: data\n        };\n        if (action == 'GET') delete options.body;\n        fetch(url, options).then((res) => {\n            if (res.ok && action != 'GET') alert('Thành công');\n            if (res.status > 299) location.href = \"/login.html\";\n            if (res.ok && entity == 'login') {\n                loginsuccess = true;\n                return res.text();\n            }\n            return res.json();\n        }).then(res => {\n            if (entity == 'login' && loginsuccess) {\n                localStorage.setItem(\"accesstoken\", res);\n                location.href = '/base/list-jobs.html';\n            }\n            if (res.message) alert(res.message);\n            if (action == 'PUT') {\n                editModal.hide();\n                $('#example').DataTable().ajax.reload();\n            }\n            return Promise.resolve(res);\n        }).then(res => {\n            if (action == 'GET') {\n                switch (entity) {\n                    case 'employees':\n                        employeeSl = loadField('employeeCode', res, null);\n                        break;\n                    case 'menus':\n                        unitProcSl = loadField('unitProcess', res.filter(i => i.category == 'DVXL'), null);\n                        break;\n                    default:\n                        break;\n                }\n            }\n        });\n    }\n}\nfunction loadField(fieldId, array, value) {\n    return $('#' + fieldId).selectize({\n        maxItems: null,\n        valueField: 'code',\n        labelField: 'code',\n        searchField: 'code',\n        options: array,\n        create: false\n    });\n}\nfunction logout() {\n    localStorage.setItem(\"accesstoken\", \"\");\n}\nfunction getnewcode() {\n    requestHeader = {\n        'crossorigin': true,\n        'Access-Control-Allow-Origin': '*',\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": \"Bearer \" + localStorage.getItem(\"accesstoken\")\n    };\n\n    let options = {\n        method: 'GET',\n        headers: requestHeader,\n    };\n\n    fetch('/api/v1/problems/newcode'\n        , options).then((res) => res.json()).then(res => document.querySelector('#scCode').value = document.querySelector('#region').value + 'SC' + (res+'').padStart(9,0));\n}\nfunction scCodeBlur(e) {\n    if (!document.querySelector('#scCode').value) return;\n    requestHeader = {\n        'crossorigin': true,\n        'Access-Control-Allow-Origin': '*',\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": \"Bearer \" + localStorage.getItem(\"accesstoken\")\n    };\n    let options = {\n        method: 'GET',\n        headers: requestHeader,\n    };\n\n    fetch('/api/v1/problems/code/' + document.querySelector('#scCode').value\n        , options).then((res) => res.json()).then(res => {\n            console.log(res)\n            document.querySelector('#problemInfo').value = res.info;\n            document.querySelector('#problemStatus').value = res.status;\n            document.querySelector('#region').value = res.region;\n            document.querySelector('#informMethod').value = res.informMethod;\n            document.querySelector('#rootCause').value = res.rootCause;\n            document.querySelector('#customerContact').value = res.customerContact;\n            document.querySelector('#jobOfNetworkAndTD').value = res.nocAndTechWorks;\n            // thoi gian bat dau KT\n            document.querySelector('#startDate').value = res.technicalStart;\n            // thoi gian hoan thanh KT\n            document.querySelector('#doneDate').value = res.doneDate;\n            // tg ky thuat ket thuc\n            document.querySelector('#dateEnd').value = res.technicalDone;\n            // loai dich vu\n            document.querySelector('#serviceType').value = res.serviceType;\n        }\n        );\n}\nfunction dailyStatistic(e) {\n    let qry = '';\n    if (document.querySelector('#chooseDate').value) {\n        qry = '?date=' + document.querySelector('#chooseDate').value\n    }\n    requestHeader = {\n        'crossorigin': true,\n        'Access-Control-Allow-Origin': '*',\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": \"Bearer \" + localStorage.getItem(\"accesstoken\")\n    };\n    let options = {\n        method: 'GET',\n        headers: requestHeader,\n    };\n    fetch('/api/v1/dailystatistic' + qry\n        , options).then((res) => res.json()).then(res => {\n            console.log(res);\n            let rows = [];\n\n            Object.entries(res.dic).forEach(o => {\n                rows.push('<tr><td width=\"15%\"><b>' + o[0] + '</b></td><td>' + o[1].filter((value, index, array) => array.indexOf(value) === index) + '</td></tr>');\n            });\n            rows.push('<tr><td><b>KT không về văn phòng, về nhà luôn:</b></td><td>' + res.notBackOffice.filter(el => !res.notAtNoc.includes(el)) + '</td></tr>');\n\n            rows.push('<tr><td><b>Nghỉ phép, Nghỉ trực NOC:</b></td><td>' + res.notAtNoc + '</td></tr>');\n            let info = '<table class=\"table\">';\n            rows.sort();\n            rows.forEach(i => info += i);\n            info += '</table>';\n            document.querySelector(\"#dailystatistic\").innerHTML = info;\n        }\n        );\n}"],"mappings":"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"}