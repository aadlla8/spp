{"version":3,"file":"spp.js","names":["baseUrl","registerUrl","loginUrl","employeeSl","unitProcSl","loginsuccess","processForm","action","form","entity","classList","contains","checkValidity","url","id","value","data","fData","FormData","set","selectize","getValue","JSON","stringify","Object","fromEntries","requestHeader","localStorage","getItem","options","method","headers","body","fetch","then","res","ok","alert","status","location","href","text","json","setItem","message","editModal","hide","$","DataTable","ajax","reload","Promise","resolve","loadField","filter","i","categpry","fieldId","array","maxItems","valueField","labelField","searchField","create","logout"],"sources":["../../src/js/spp.js"],"sourcesContent":["var baseUrl = \"/api/v1/\";\nvar registerUrl = \"/auth/addNewUser\";\nvar loginUrl = \"/auth/generateToken\";\nvar employeeSl;\nvar unitProcSl;\nvar loginsuccess = false;\nfunction processForm(action, form, entity) {\n    loginsuccess = false;\n    if (action == 'GET' || (form.classList.contains('was-validated') && form.checkValidity())) {\n        let url = baseUrl + entity;\n        if (entity == 'register') url = registerUrl;\n        if (entity == 'login') url = loginUrl;\n        if (action == 'PUT') {\n            url += '/' + form.id.value;\n        }\n        let data = '';\n\n        if (form != null) {\n            let fData = new FormData(form);\n            if (entity == 'jobs')\n                fData.set('employeeCode', employeeSl[0].selectize.getValue())\n            if(entity =='problems')\n                fData.set('unitProcess', unitProcSl[0].selectize.getValue())\n            data = JSON.stringify(Object.fromEntries(fData));\n        }\n\n        let requestHeader = {\n            \"Content-Type\": \"application/json\",\n        };\n        if (entity != 'login' && entity != 'register') {\n            requestHeader = {\n                'crossorigin': true,\n                'Access-Control-Allow-Origin': '*',\n                \"Content-Type\": \"application/json\",\n                \"Authorization\": \"Bearer \" + localStorage.getItem(\"accesstoken\")\n            };\n        }\n        let options = {\n            method: action,\n            headers: requestHeader,\n            body: data\n        };\n        if (action == 'GET') delete options.body;\n        fetch(url, options).then((res) => {\n            if (res.ok && action != 'GET') alert('Thành công');\n            if (res.status > 299) location.href = \"/login.html\";\n            if (res.ok && entity == 'login') {\n                loginsuccess = true;\n                return res.text();\n            }\n            return res.json();\n        }).then(res => {\n            if (entity == 'login' && loginsuccess) {\n                localStorage.setItem(\"accesstoken\", res);\n                location.href = '/base/list-jobs.html';\n            }\n            if (res.message) alert(res.message);\n            if (action == 'PUT') {\n                editModal.hide();\n                $('#example').DataTable().ajax.reload();\n            }\n            return Promise.resolve(res);\n        }).then(res => {\n            if (action == 'GET') {\n                switch (entity) {\n                    case 'employees':\n                        employeeSl = loadField('employeeCode', res, null);\n                        break;\n                    case 'menus':                        \n                        unitProcSl = loadField('unitProcess',res.filter(i=>i.categpry='DVXL'),null);\n                        break;\n                    default:\n                        break;\n                }\n            }\n        });\n    }\n}\nfunction loadField(fieldId, array, value) {   \n   return $('#'+fieldId).selectize({\n        maxItems: null,\n        valueField: 'code',\n        labelField: 'code',\n        searchField: 'code',\n        options: array,\n        create: false\n    });\n}\nfunction logout() {\n    localStorage.setItem(\"accesstoken\", \"\");\n}\n"],"mappings":"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"}